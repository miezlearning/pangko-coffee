<!DOCTYPE html>
<html lang="id">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Pangko Coffee ¬∑ Dashboard</title>
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Twemoji to ensure emojis render consistently across platforms -->
    <!-- Removed crossorigin attribute because the CDN resource does not set CORS headers and modern browsers block the fetch when crossorigin is present. If needed, host twemoji locally or use an alternative CDN. -->
    <script src="https://twemoji.maxcdn.com/v/latest/twemoji.min.js"></script>
        <script>
            tailwind.config = {
                theme: {
                    extend: {
                        fontFamily: {
                            // Add robust emoji fallbacks so emojis render on Windows/macOS/Linux
                            sans: ['Manrope', 'Segoe UI Emoji', 'Apple Color Emoji', 'Noto Color Emoji', 'system-ui', 'sans-serif']
                        },
                        colors: {
                            matcha: '#74A662',
                            cream: '#FFFDD0',
                            charcoal: '#333333',
                            peach: '#FFE5B4'
                        },
                        boxShadow: {
                            glow: '0 35px 80px -45px rgba(116, 166, 98, 0.65)'
                        }
                    }
                }
            }
        </script>
        <style>
            /* Ensure emoji fonts are used where available (especially on Windows) */
            body { font-family: Manrope, "Segoe UI Emoji", "Apple Color Emoji", "Noto Color Emoji", system-ui, sans-serif; }
            /* Normalize emoji image sizing when Twemoji replaces glyphs */
            img.emoji { height: 1em; width: 1em; margin: 0 .05em; vertical-align: -0.15em; }
            .tab-content {
                animation: fadeIn 0.3s ease-in-out;
            }
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(10px); }
                to { opacity: 1; transform: translateY(0); }
            }
        </style>
  </head>
  <body class="min-h-screen bg-cream text-charcoal antialiased" data-page="dashboard">
    <!-- Navbar will be injected here by navbar.js -->
    <div id="navbar-container"></div>        <main class="relative mx-auto flex w-full max-w-[1400px] flex-col gap-8 px-4 sm:px-6 lg:px-8 pt-32 pb-16">
            <!-- Hero / Overview -->
            <section class="relative grid gap-6 lg:grid-cols-2 lg:gap-8">
                <div class="relative overflow-hidden rounded-3xl bg-white/95 px-8 py-10 shadow-xl backdrop-blur-sm">
                    <div class="pointer-events-none absolute -left-16 -top-16 h-64 w-64 rounded-full bg-matcha/20 blur-3xl"></div>
                    <div class="pointer-events-none absolute -right-12 bottom-0 h-56 w-56 rounded-full bg-peach/30 blur-3xl"></div>
                    <div class="relative flex flex-col gap-5">
                        <div class="flex items-center justify-between">
                            <span class="inline-flex items-center gap-2 rounded-full bg-matcha/15 px-4 py-1.5 text-xs font-bold uppercase tracking-wider text-matcha">
                                <span class="h-2 w-2 rounded-full bg-matcha animate-pulse"></span>
                                Realtime
                            </span>
                        </div>
                        <div>
                            <h1 class="text-3xl font-extrabold leading-tight text-charcoal md:text-4xl lg:text-5xl">Dashboard Kasir</h1>
                            <p class="mt-3 max-w-xl text-sm text-charcoal/70 md:text-base">
                                Pantau status pembayaran dan antrian pesanan secara realtime. Semangat kerjanya sayang! ‚òï
                            </p>
                        </div>
                        
                        <!-- Primary Actions -->
                        <div class="flex flex-col gap-3 pt-2">
                            <a href="/cashier" class="group inline-flex items-center justify-center gap-3 rounded-2xl bg-gradient-to-r from-peach to-orange-300 px-6 py-4 text-base font-bold text-charcoal shadow-lg shadow-peach/30 transition-all hover:shadow-xl hover:-translate-y-0.5 md:text-lg">
                                üßæ Buka Kasir / Buat Pesanan 
                                <span class="transition-transform group-hover:translate-x-1">‚Üí</span>
                            </a>
                            
                            <div class="grid grid-cols-2 gap-3">
                                <a href="#stats" class="group inline-flex items-center justify-center gap-2 rounded-xl bg-matcha px-4 py-3 text-sm font-semibold text-white shadow-md shadow-matcha/20 transition-all hover:-translate-y-0.5 hover:shadow-lg">
                                    üìä Statistik
                                </a>
                                <a href="/analytics" class="inline-flex items-center justify-center gap-2 rounded-xl border-2 border-matcha/30 bg-white px-4 py-3 text-sm font-semibold text-matcha transition-all hover:bg-matcha/10">
                                    üìà Analisis
                                </a>
                            </div>
                        </div>

                        <!-- Secondary Actions -->
                        <div class="flex flex-wrap gap-2 pt-2 border-t border-charcoal/10">
                            <button onclick="testOpenDrawer()" class="inline-flex items-center gap-2 rounded-xl border-2 border-orange-400 bg-orange-50 px-4 py-2.5 text-xs font-semibold text-orange-700 transition-all hover:bg-orange-100 hover:shadow-sm">
                                üí∞ Buka Laci
                            </button>
                            <a href="/tools/printer" class="inline-flex items-center gap-2 rounded-xl border border-charcoal/20 bg-white/80 px-4 py-2.5 text-xs font-semibold text-charcoal transition-all hover:bg-white hover:shadow-sm">
                                üõ†Ô∏è Template Struk
                                <span class="rounded-full bg-charcoal/10 px-2 py-0.5 text-[10px] font-bold" data-current-template-label>...</span>
                            </a>
                        </div>

                        <!-- Info Cards -->
                        <dl class="grid gap-3 pt-3 sm:grid-cols-2">
                            <div class="rounded-xl border border-matcha/20 bg-gradient-to-br from-matcha/5 to-matcha/10 px-4 py-3">
                                <dt class="text-[10px] uppercase tracking-wider text-charcoal/50 font-bold">Auto Refresh</dt>
                                <dd class="mt-1.5 flex items-center gap-2 text-sm font-bold text-charcoal">
                                    <span class="text-matcha">‚ü≥</span> Setiap 3 detik
                                </dd>
                            </div>
                            <div class="rounded-xl border border-peach/25 bg-gradient-to-br from-peach/5 to-peach/10 px-4 py-3">
                                <dt class="text-[10px] uppercase tracking-wider text-charcoal/50 font-bold">Integrasi</dt>
                                <dd class="mt-1.5 flex items-center gap-2 text-sm font-bold text-charcoal">
                                    <span class="text-orange-600">‚ö°</span> Bot & Dashboard
                                </dd>
                            </div>
                        </dl>
                    </div>
                </div>

                <div class="relative min-h-[400px] lg:min-h-[500px]">
                    <div class="absolute inset-0 overflow-hidden rounded-3xl">
                        <img src="https://i.imgur.com/7WKNNSY.jpeg" alt="Barista making matcha latte" class="h-full w-full object-cover" />
                        <div class="absolute inset-0 bg-gradient-to-t from-charcoal/90 via-charcoal/40 to-transparent"></div>
                    </div>
                    <div class="relative flex h-full min-h-[400px] lg:min-h-[500px] flex-col justify-end p-6">
                        <div class="w-full rounded-2xl bg-white/95 p-6 shadow-2xl backdrop-blur-md">
                            <div class="flex items-start justify-between gap-4 mb-5">
                                <div>
                                    <h2 class="text-xl font-bold text-charcoal">Status Gateway</h2>
                                    <p class="mt-1 text-xs text-charcoal/60 leading-relaxed">Sinkron dengan kasir & bot WhatsApp</p>
                                </div>
                                <span id="status-badge" class="inline-flex items-center gap-2 rounded-full bg-matcha/15 px-3 py-1.5 text-xs font-bold text-matcha">
                                    <svg class="h-2.5 w-2.5 text-matcha" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                                        <circle cx="8" cy="8" r="8" />
                                    </svg>
                                    ONLINE
                                </span>
                            </div>
                            
                            <div class="space-y-3">
                                <div class="rounded-xl border border-matcha/20 bg-gradient-to-br from-matcha/5 to-matcha/10 p-4">
                                    <p class="text-[10px] uppercase tracking-wider text-matcha/70 font-bold mb-3">Notifikasi Suara</p>
                                    <button id="sound-toggle" onclick="toggleSound()" class="w-full inline-flex items-center justify-center gap-2 rounded-lg border-2 border-matcha/40 bg-white px-4 py-2.5 text-sm font-bold text-matcha transition-all hover:bg-matcha hover:text-white hover:border-matcha">
                                        üîî Sound: ON
                                    </button>
                                    <div class="mt-3">
                                        <label for="notif-sound-select" class="block text-xs font-bold mb-2 text-charcoal/70">Pilih suara:</label>
                                        <select id="notif-sound-select" class="w-full rounded-lg border-2 border-matcha/30 px-3 py-2 text-sm font-semibold text-matcha bg-white focus:outline-none focus:border-matcha focus:ring-2 focus:ring-matcha/20 transition-all">
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Quick Stats Bar -->
            <section id="stats" class="relative">
                <div class="relative rounded-2xl border border-white/50 bg-white/95 p-6 shadow-xl backdrop-blur-sm">
                    <div class="flex flex-col gap-5 lg:flex-row lg:items-center lg:justify-between">
                        <div class="flex items-center gap-4">
                            <div class="rounded-xl bg-gradient-to-br from-matcha/20 to-matcha/10 p-3">
                                <svg class="h-7 w-7 text-matcha" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                                </svg>
                            </div>
                            <div>
                                <h2 class="text-xl font-bold text-charcoal">Ringkasan Hari Ini</h2>
                                <p class="text-xs text-charcoal/60 flex items-center gap-1.5">
                                    <span class="h-1.5 w-1.5 rounded-full bg-matcha animate-pulse"></span>
                                    Update otomatis setiap 3 detik
                                </p>
                            </div>
                        </div>
                        <div class="flex flex-wrap items-center gap-3">
                            <div class="rounded-xl border-2 border-matcha/20 bg-gradient-to-br from-matcha/5 to-matcha/10 px-5 py-3 min-w-[120px]">
                                <p class="text-xs font-bold text-charcoal/60 flex items-center gap-1">
                                    üì¶ Pesanan
                                </p>
                                <span id="today-orders" class="mt-1 block text-3xl font-extrabold text-charcoal">-</span>
                            </div>
                            <div class="rounded-xl border-2 border-peach/25 bg-gradient-to-br from-peach/5 to-orange-100/30 px-5 py-3 min-w-[140px]">
                                <p class="text-xs font-bold text-charcoal/60 flex items-center gap-1">
                                    üí∞ Revenue
                                </p>
                                <span id="today-revenue" class="mt-1 block text-3xl font-extrabold text-charcoal">-</span>
                            </div>
                            <a href="/analytics" class="inline-flex items-center gap-2 rounded-xl border-2 border-matcha/30 bg-white px-5 py-3 text-sm font-bold text-matcha transition-all hover:bg-matcha hover:text-white hover:shadow-lg hover:-translate-y-0.5">
                                <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M3 3v18h18" />
                                    <path d="M9 17V9" />
                                    <path d="M13 17V5" />
                                    <path d="M17 17v-7" />
                                </svg>
                                Detail Statistik
                            </a>
                        </div>
                    </div>
                </div>
            </section>


            <!-- Tab Navigation -->
            <section class="relative">
                <div class="relative rounded-2xl border border-white/50 bg-white/95 shadow-xl backdrop-blur-sm overflow-hidden">
                    <!-- Tab Buttons -->
                    <div class="flex overflow-x-auto border-b-2 border-charcoal/10 bg-gradient-to-r from-cream/40 to-peach/30 scrollbar-hide">
                        <button onclick="switchTab('qris')" id="tab-qris" class="tab-btn flex-1 min-w-[140px] px-4 py-4 text-xs font-bold transition-all border-b-4 border-transparent hover:bg-white/70 hover:border-amber-400">
                            <div class="flex flex-col items-center gap-2">
                                <div class="rounded-xl bg-amber-100 p-2">
                                    <svg class="h-5 w-5 text-amber-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6 6 0 10-12 0v3.159c0 .538-.214 1.055-.595 1.436L4 17h5" />
                                        <path d="M13.73 21a2 2 0 01-3.46 0" />
                                    </svg>
                                </div>
                                <span class="text-charcoal">Pending QRIS</span>
                                <span id="count-qris" class="rounded-full bg-red-500 px-2.5 py-0.5 text-xs text-white font-bold shadow-sm">0</span>
                            </div>
                        </button>
                        <button onclick="switchTab('cash')" id="tab-cash" class="tab-btn flex-1 min-w-[140px] px-4 py-4 text-xs font-bold transition-all border-b-4 border-transparent hover:bg-white/70 hover:border-orange-400">
                            <div class="flex flex-col items-center gap-2">
                                <div class="rounded-xl bg-orange-100 p-2">
                                    <svg class="h-5 w-5 text-orange-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
                                        <path d="M1 10h22" />
                                        <circle cx="12" cy="12" r="3"></circle>
                                    </svg>
                                </div>
                                <span class="text-charcoal">Pending Tunai</span>
                                <span id="count-cash" class="rounded-full bg-orange-500 px-2.5 py-0.5 text-xs text-white font-bold shadow-sm">0</span>
                            </div>
                        </button>
                        <button onclick="switchTab('processing')" id="tab-processing" class="tab-btn flex-1 min-w-[140px] px-4 py-4 text-xs font-bold transition-all border-b-4 border-transparent hover:bg-white/70 hover:border-blue-400">
                            <div class="flex flex-col items-center gap-2">
                                <div class="rounded-xl bg-blue-100 p-2">
                                    <svg class="h-5 w-5 text-blue-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M18 8v2a4 4 0 01-4 4H6a4 4 0 01-4-4V8"></path>
                                        <path d="M3 3h18v2a4 4 0 01-4 4H7a4 4 0 01-4-4V3z"></path>
                                        <path d="M16 18a2 2 0 01-2 2H6a2 2 0 01-2-2"></path>
                                    </svg>
                                </div>
                                <span class="text-charcoal">Diproses</span>
                                <span id="count-processing" class="rounded-full bg-blue-500 px-2.5 py-0.5 text-xs text-white font-bold shadow-sm">0</span>
                            </div>
                        </button>
                        <button onclick="switchTab('ready')" id="tab-ready" class="tab-btn flex-1 min-w-[140px] px-4 py-4 text-xs font-bold transition-all border-b-4 border-transparent hover:bg-white/70 hover:border-green-400">
                            <div class="flex flex-col items-center gap-2">
                                <div class="rounded-xl bg-green-100 p-2">
                                    <svg class="h-5 w-5 text-green-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M9 12l2 2 4-4"></path>
                                        <circle cx="12" cy="12" r="9"></circle>
                                    </svg>
                                </div>
                                <span class="text-charcoal">Siap Diambil</span>
                                <span id="count-ready" class="rounded-full bg-green-500 px-2.5 py-0.5 text-xs text-white font-bold shadow-sm">0</span>
                            </div>
                        </button>
                        <button onclick="switchTab('cancelled')" id="tab-cancelled" class="tab-btn flex-1 min-w-[140px] px-4 py-4 text-xs font-bold transition-all border-b-4 border-transparent hover:bg-white/70 hover:border-gray-400">
                            <div class="flex flex-col items-center gap-2">
                                <div class="rounded-xl bg-gray-100 p-2">
                                    <svg class="h-5 w-5 text-gray-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <rect x="6" y="5" width="4" height="14"></rect>
                                        <rect x="14" y="5" width="4" height="14"></rect>
                                    </svg>
                                </div>
                                <span class="text-charcoal">Dibatalkan</span>
                                <span id="count-cancelled" class="rounded-full bg-gray-500 px-2.5 py-0.5 text-xs text-white font-bold shadow-sm">0</span>
                            </div>
                        </button>
                    </div>

                    <!-- Tab Content -->
                    <div class="p-8">
                        <!-- QRIS Tab -->
                        <div id="content-qris" class="tab-content hidden">
                            <div class="flex flex-col gap-4 border-b border-charcoal/10 pb-5 mb-6 sm:flex-row sm:items-center sm:justify-between">
                                <div>
                                    <h3 class="text-2xl font-bold flex items-center gap-3">
                                        <span class="rounded-full bg-red-500/15 p-2">üîî</span>
                                        Pending Payments (QRIS)
                                    </h3>
                                    <p class="text-sm text-charcoal/60 mt-1">Konfirmasi pembayaran QRIS langsung dari sini</p>
                                </div>
                                <button onclick="loadPayments()" class="inline-flex items-center gap-2 rounded-full border border-matcha/30 bg-matcha px-5 py-2.5 text-sm font-semibold text-white transition hover:bg-matcha/90 shadow-md">
                                    üîÑ Refresh
                                </button>
                            </div>
                            <div class="mb-6 flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
                                <div class="relative w-full md:max-w-sm">
                                    <span class="pointer-events-none absolute left-4 top-1/2 -translate-y-1/2 text-charcoal/40">üîç</span>
                                    <input id="search-qris" type="text" oninput="handleSearch('qris', this.value)" placeholder="Cari order, nama customer, atau nomor WhatsApp" class="w-full rounded-2xl border border-charcoal/10 bg-white/90 py-3 pl-10 pr-4 text-sm outline-none ring-matcha/20 focus:border-matcha/40 focus:ring-2" />
                                </div>
                                <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:gap-3">
                                    <label for="sort-qris" class="text-xs font-semibold uppercase tracking-[0.25em] text-charcoal/50">Urutkan</label>
                                    <select id="sort-qris" onchange="handleSort('qris', this.value)" class="w-full rounded-2xl border border-charcoal/10 bg-white px-4 py-3 text-sm font-semibold text-charcoal/80 outline-none ring-matcha/20 focus:border-matcha/40 focus:ring-2 sm:w-auto">
                                        <option value="newest" selected>Terbaru</option>
                                        <option value="oldest">Terlama</option>
                                        <option value="amount_desc">Nominal terbesar</option>
                                        <option value="amount_asc">Nominal terkecil</option>
                                        <option value="name_az">Nama A ‚Üí Z</option>
                                        <option value="name_za">Nama Z ‚Üí A</option>
                                    </select>
                                </div>
                            </div>
                            <div id="payments-list" class="space-y-4"></div>
                        </div>

                        <!-- Cash Tab -->
                        <div id="content-cash" class="tab-content hidden">
                            <div class="flex flex-col gap-4 border-b border-charcoal/10 pb-5 mb-6 sm:flex-row sm:items-center sm:justify-between">
                                <div>
                                    <h3 class="text-2xl font-bold flex items-center gap-3">
                                        <span class="rounded-full bg-orange-500/15 p-2">üíµ</span>
                                        Menunggu Konfirmasi Tunai
                                    </h3>
                                    <p class="text-sm text-charcoal/60 mt-1">Terima pembayaran tunai untuk mulai proses barista</p>
                                </div>
                                <button onclick="loadPendingCash()" class="inline-flex items-center gap-2 rounded-full border border-orange-500/30 bg-orange-500 px-5 py-2.5 text-sm font-semibold text-white transition hover:bg-orange-500/90 shadow-md">
                                    üîÑ Refresh
                                </button>
                            </div>
                            <div class="mb-6 flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
                                <div class="relative w-full md:max-w-sm">
                                    <span class="pointer-events-none absolute left-4 top-1/2 -translate-y-1/2 text-charcoal/40">üîç</span>
                                    <input id="search-cash" type="text" oninput="handleSearch('cash', this.value)" placeholder="Cari order, nama customer, atau nomor WhatsApp" class="w-full rounded-2xl border border-charcoal/10 bg-white/90 py-3 pl-10 pr-4 text-sm outline-none ring-orange-400/20 focus:border-orange-400/40 focus:ring-2" />
                                </div>
                                <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:gap-3">
                                    <label for="sort-cash" class="text-xs font-semibold uppercase tracking-[0.25em] text-charcoal/50">Urutkan</label>
                                    <select id="sort-cash" onchange="handleSort('cash', this.value)" class="w-full rounded-2xl border border-charcoal/10 bg-white px-4 py-3 text-sm font-semibold text-charcoal/80 outline-none ring-orange-400/20 focus:border-orange-400/40 focus:ring-2 sm:w-auto">
                                        <option value="newest" selected>Terbaru</option>
                                        <option value="oldest">Terlama</option>
                                        <option value="amount_desc">Nominal terbesar</option>
                                        <option value="amount_asc">Nominal terkecil</option>
                                        <option value="name_az">Nama A ‚Üí Z</option>
                                        <option value="name_za">Nama Z ‚Üí A</option>
                                    </select>
                                </div>
                            </div>
                            <div id="pending-cash-list" class="space-y-4"></div>
                        </div>

                        <!-- Processing Tab -->
                        <div id="content-processing" class="tab-content hidden">
                            <div class="flex flex-col gap-4 border-b border-charcoal/10 pb-5 mb-6 sm:flex-row sm:items-center sm:justify-between">
                                <div>
                                    <h3 class="text-2xl font-bold flex items-center gap-3">
                                        <span class="rounded-full bg-blue-500/15 p-2">üë®‚Äçüç≥</span>
                                        Sedang Diproses
                                    </h3>
                                    <p class="text-sm text-charcoal/60 mt-1">Monitor progres barista dan tandai pesanan siap</p>
                                </div>
                                <button onclick="loadProcessingOrders()" class="inline-flex items-center gap-2 rounded-full border border-blue-500/30 bg-blue-500 px-5 py-2.5 text-sm font-semibold text-white transition hover:bg-blue-500/90 shadow-md">
                                    üîÑ Refresh
                                </button>
                            </div>
                            <div class="mb-6 flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
                                <div class="relative w-full md:max-w-sm">
                                    <span class="pointer-events-none absolute left-4 top-1/2 -translate-y-1/2 text-charcoal/40">üîç</span>
                                    <input id="search-processing" type="text" oninput="handleSearch('processing', this.value)" placeholder="Cari order, nama customer, atau nomor WhatsApp" class="w-full rounded-2xl border border-charcoal/10 bg-white/90 py-3 pl-10 pr-4 text-sm outline-none ring-blue-500/20 focus:border-blue-500/40 focus:ring-2" />
                                </div>
                                <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:gap-3">
                                    <label for="sort-processing" class="text-xs font-semibold uppercase tracking-[0.25em] text-charcoal/50">Urutkan</label>
                                    <select id="sort-processing" onchange="handleSort('processing', this.value)" class="w-full rounded-2xl border border-charcoal/10 bg-white px-4 py-3 text-sm font-semibold text-charcoal/80 outline-none ring-blue-500/20 focus:border-blue-500/40 focus:ring-2 sm:w-auto">
                                        <option value="newest" selected>Terbaru</option>
                                        <option value="oldest">Terlama</option>
                                        <option value="amount_desc">Nominal terbesar</option>
                                        <option value="amount_asc">Nominal terkecil</option>
                                        <option value="name_az">Nama A ‚Üí Z</option>
                                        <option value="name_za">Nama Z ‚Üí A</option>
                                    </select>
                                </div>
                            </div>
                            <div id="processing-list" class="space-y-4"></div>
                        </div>

                        <!-- Ready Tab -->
                        <div id="content-ready" class="tab-content hidden">
                            <div class="flex flex-col gap-4 border-b border-charcoal/10 pb-5 mb-6 sm:flex-row sm:items-center sm:justify-between">
                                <div>
                                    <h3 class="text-2xl font-bold flex items-center gap-3">
                                        <span class="rounded-full bg-green-500/15 p-2 ring-4 ring-green-500/20 animate-pulse">‚úÖ</span>
                                        Siap Diambil
                                    </h3>
                                    <p class="text-sm text-charcoal/60 mt-1">Tandai selesai jika customer sudah mengambil pesanan</p>
                                </div>
                                <button onclick="loadReadyOrders()" class="inline-flex items-center gap-2 rounded-full border border-green-500/30 bg-green-500 px-5 py-2.5 text-sm font-semibold text-white transition hover:bg-green-500/90 shadow-md">
                                    üîÑ Refresh
                                </button>
                            </div>
                            <div class="mb-6 flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
                                <div class="relative w-full md:max-w-sm">
                                    <span class="pointer-events-none absolute left-4 top-1/2 -translate-y-1/2 text-charcoal/40">üîç</span>
                                    <input id="search-ready" type="text" oninput="handleSearch('ready', this.value)" placeholder="Cari order, nama customer, atau nomor WhatsApp" class="w-full rounded-2xl border border-charcoal/10 bg-white/90 py-3 pl-10 pr-4 text-sm outline-none ring-green-500/20 focus:border-green-500/40 focus:ring-2" />
                                </div>
                                <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:gap-3">
                                    <label for="sort-ready" class="text-xs font-semibold uppercase tracking-[0.25em] text-charcoal/50">Urutkan</label>
                                    <select id="sort-ready" onchange="handleSort('ready', this.value)" class="w-full rounded-2xl border border-charcoal/10 bg-white px-4 py-3 text-sm font-semibold text-charcoal/80 outline-none ring-green-500/20 focus:border-green-500/40 focus:ring-2 sm:w-auto">
                                        <option value="newest" selected>Terbaru</option>
                                        <option value="oldest">Terlama</option>
                                        <option value="amount_desc">Nominal terbesar</option>
                                        <option value="amount_asc">Nominal terkecil</option>
                                        <option value="name_az">Nama A ‚Üí Z</option>
                                        <option value="name_za">Nama Z ‚Üí A</option>
                                    </select>
                                </div>
                            </div>
                            <div id="ready-list" class="space-y-4"></div>
                        </div>

                        <!-- Cancelled Tab -->
                        <div id="content-cancelled" class="tab-content hidden">
                            <div class="flex flex-col gap-4 border-b border-charcoal/10 pb-5 mb-6 sm:flex-row sm:items-center sm:justify-between">
                                <div>
                                    <h3 class="text-2xl font-bold flex items-center gap-3">
                                        <span class="rounded-full bg-gray-500/15 p-2">‚è∏Ô∏è</span>
                                        Dibatalkan (Tunai) - Bisa Dibuka Kembali
                                    </h3>
                                    <p class="text-sm text-charcoal/60 mt-1">Hanya yang masih dalam window buka kembali</p>
                                </div>
                                <button onclick="loadCancelledCash()" class="inline-flex items-center gap-2 rounded-full border border-gray-500/30 bg-gray-500 px-5 py-2.5 text-sm font-semibold text-white transition hover:bg-gray-500/90 shadow-md">
                                    üîÑ Refresh
                                </button>
                            </div>
                            <div class="mb-6 flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
                                <div class="relative w-full md:max-w-sm">
                                    <span class="pointer-events-none absolute left-4 top-1/2 -translate-y-1/2 text-charcoal/40">üîç</span>
                                    <input id="search-cancelled" type="text" oninput="handleSearch('cancelled', this.value)" placeholder="Cari order, nama customer, atau nomor WhatsApp" class="w-full rounded-2xl border border-charcoal/10 bg-white/90 py-3 pl-10 pr-4 text-sm outline-none ring-gray-500/20 focus:border-gray-500/40 focus:ring-2" />
                                </div>
                                <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:gap-3">
                                    <label for="sort-cancelled" class="text-xs font-semibold uppercase tracking-[0.25em] text-charcoal/50">Urutkan</label>
                                    <select id="sort-cancelled" onchange="handleSort('cancelled', this.value)" class="w-full rounded-2xl border border-charcoal/10 bg-white px-4 py-3 text-sm font-semibold text-charcoal/80 outline-none ring-gray-500/20 focus:border-gray-500/40 focus:ring-2 sm:w-auto">
                                        <option value="newest" selected>Terbaru</option>
                                        <option value="oldest">Terlama</option>
                                        <option value="amount_desc">Nominal terbesar</option>
                                        <option value="amount_asc">Nominal terkecil</option>
                                        <option value="name_az">Nama A ‚Üí Z</option>
                                        <option value="name_za">Nama Z ‚Üí A</option>
                                    </select>
                                </div>
                            </div>
                            <div id="cancelled-cash-list" class="space-y-4"></div>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Toast Notification -->
        <div id="notification" class="fixed right-6 top-6 hidden w-full max-w-xs -translate-y-2 rounded-3xl border border-matcha/20 bg-white/95 p-5 text-sm opacity-0 shadow-2xl shadow-matcha/20 transition-all duration-300 backdrop-blur">
            <p class="font-semibold inline-flex items-center gap-2">
                <svg class="h-5 w-5 text-matcha" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                    <path d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6 6 0 10-12 0v3.159c0 .538-.214 1.055-.595 1.436L4 17h5" />
                    <path d="M13.73 21a2 2 0 01-3.46 0" />
                </svg>
                Pembayaran Baru!
            </p>
            <p id="notification-text" class="mt-1 text-charcoal/70"></p>
        </div>

        <!-- Reject Modal -->
        <div id="reject-modal" class="fixed inset-0 z-50 hidden items-center justify-center bg-charcoal/40 p-4 opacity-0 transition-opacity duration-200">
            <div class="w-full max-w-md rounded-3xl border border-white/50 bg-white/95 p-6 shadow-2xl">
                <div class="mb-4">
                    <h3 class="text-lg font-semibold">‚ùå Tolak Pembayaran</h3>
                    <p class="mt-1 text-sm text-charcoal/65">Berikan alasan penolakan. Customer akan menerima pesan ini.</p>
                </div>
                <label for="reject-reason" class="mb-2 block text-xs font-semibold uppercase tracking-[0.25em] text-charcoal/60">Alasan</label>
                <textarea id="reject-reason" rows="4" class="w-full rounded-2xl border border-charcoal/10 bg-white/90 p-3 text-sm outline-none ring-matcha/30 focus:ring-2" placeholder="Contoh: Bukti transfer tidak sesuai / kode nominal salah"></textarea>
                <div class="mt-5 grid grid-cols-2 gap-3">
                    <button id="reject-cancel" class="rounded-2xl border border-charcoal/15 bg-white px-4 py-2 text-sm font-semibold text-charcoal/70 transition hover:bg-charcoal/5">Batal</button>
                    <button id="reject-submit" class="rounded-2xl bg-rose-500 px-4 py-2 text-sm font-semibold text-white transition hover:opacity-90">Tolak Pembayaran</button>
                </div>
            </div>
        </div>

        <!-- Receipt Preview Modal -->
        <div id="preview-modal" class="fixed inset-0 z-50 hidden items-center justify-center bg-charcoal/40 p-4 opacity-0 transition-opacity duration-200">
            <div class="w-full max-w-2xl rounded-3xl border border-white/50 bg-white/95 shadow-2xl">
                <div class="flex items-center justify-between border-b border-charcoal/10 px-6 py-4">
                    <div>
                        <h3 class="text-lg font-semibold">üëÄ Preview Struk</h3>
                        <p id="preview-order-subtitle" class="text-xs text-charcoal/60"></p>
                        <div class="mt-2 flex flex-wrap items-center gap-2 text-xs text-charcoal/60">
                            <span id="preview-template-pill" class="rounded-full bg-charcoal/10 px-3 py-1 font-semibold">Memuat template‚Ä¶</span>
                            <a href="/tools/printer" class="inline-flex items-center gap-1 rounded-full border border-charcoal/15 bg-white px-3 py-1 font-semibold text-charcoal/70 transition hover:bg-charcoal/5">
                                ‚öôÔ∏è Atur di Tools
                            </a>
                        </div>
                    </div>
                    <button id="preview-close" class="rounded-full border border-charcoal/15 bg-white px-3 py-1.5 text-sm font-semibold text-charcoal/70 transition hover:bg-charcoal/5">Tutup</button>
                </div>
                <div class="max-h-[70vh] overflow-auto px-6 py-5">
                    <div class="rounded-2xl border border-charcoal/10 bg-white p-4 flex flex-col gap-4">
                        <div id="preview-html" class="hidden w-full"></div>
                        <details id="preview-text-wrapper" class="rounded-xl border border-charcoal/10 bg-charcoal/2 p-3" open>
                            <summary class="cursor-pointer text-xs font-semibold uppercase tracking-[0.25em] text-charcoal/50">Versi teks struk</summary>
                            <pre id="preview-content" class="mt-3 font-mono text-[13px] leading-relaxed whitespace-pre-wrap"></pre>
                        </details>
                        <div id="preview-qr-container" class="hidden">
                            <div class="inline-flex flex-col items-center gap-2 rounded-xl border border-charcoal/10 bg-white px-4 py-3 shadow-sm">
                                <span id="preview-qr-label" class="text-xs font-semibold uppercase tracking-[0.25em] text-charcoal/60"></span>
                                <img id="preview-qr-image" class="mx-auto h-28 w-28 rounded-lg border border-charcoal/10 bg-white p-2" alt="QR code preview" />
                            </div>
                        </div>
                    </div>
                </div>
                <div class="flex items-center justify-end gap-3 border-t border-charcoal/10 px-6 py-4">
                    <button id="preview-print" class="inline-flex items-center gap-2 rounded-2xl bg-matcha px-4 py-2 text-sm font-semibold text-white transition hover:opacity-90">
                        üñ®Ô∏è Cetak Struk Ini
                    </button>
                </div>
            </div>
        </div>

        <!-- GLightbox (used for payment proof lightbox) -->
        <!-- Using GLightbox CDN to provide a stable, tested lightbox with zoom & touch support -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox/dist/css/glightbox.min.css" />

    <script src="/js/navbar.js"></script>
    <script src="/js/animations.js"></script>
    <!-- GLightbox script (must be loaded before dashboard.js which initializes it) -->
    <script src="https://cdn.jsdelivr.net/npm/glightbox/dist/js/glightbox.min.js"></script>
    <script src="/js/dashboard.js"></script>
        <script>
            // Parse emojis using Twemoji initially and whenever DOM updates (lists refresh every 3s)
            document.addEventListener('DOMContentLoaded', function () {
                if (window.twemoji) {
                    const parseAll = () => {
                        try { twemoji.parse(document.body, { folder: 'svg', ext: '.svg' }); } catch (_) {}
                    };
                    parseAll();
                    const obs = new MutationObserver(() => parseAll());
                    obs.observe(document.body, { childList: true, subtree: true });
                }
            });
        </script>
        
    </body>
</html>
